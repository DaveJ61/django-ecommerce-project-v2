<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <title>Product Detail</title>
  </head>
  <body>

{% comment %} 
<ul>
        {% for x in data %}
            <li>
            {% comment %} {{x.name}}
            {{x.category__name}} {% endcomment %}
            {% comment %} {{x.product__store_price}} {% endcomment %}
            {% comment %} {{x.id}} {% endcomment %}
            {% comment %} {{x.sku}} {% endcomment %}
            {% comment %} {{x.product}}
            {{x.product__name}}
            {{x.store_price}}
            {{x.is_default}}
            {{x.attribute_values__attribute_value}} {% endcomment %}
            {% comment %} </li> {% endcomment %}
        {% comment %} {% endfor %} {% endcomment %}
{% comment %} </ul>   

{% endcomment %}

<ul>
    <li class="text-capitalize">
    {{x.product__name}}
    </li>
    <ul class="list-unstyled">
    <li>SKU: {{x.sku}}
    <li>Price: Â£{{x.store_price}}</li>
    <li>{{x.attribute_values__attribute_value}}</li>
    <li>Stock: {{x.product_inventory__units}}</li>
    </ul>
</ul>

<ul>
  {% for y in z %}
    <li class="text-capitalize">
    {{y.product_attribute__name}}
    <ul>
      {% for a in filter %}
        {%if a.attribute_values__product_attribute__name == y.product_attribute__name  %}
        <li class="text-capitalize">
            {% if a.attribute_values__attribute_value in x.field_a %}
            <div id="target-{{a.attribute_values__attribute_value}}" class="selected fw-bold" data-attribute="{{y.product_attribute__name}}" value="{{a.attribute_values__attribute_value}}">{{a.attribute_values__attribute_value}}</div>
            {% else %}
            <div id="target-{{a.attribute_values__attribute_value}}" class="" data-attribute="{{y.product_attribute__name}}" value="{{a.attribute_values__attribute_value}}">{{a.attribute_values__attribute_value}}</div>
            {% endif %}
        </li>
        {% endif %}
      {% endfor %}
    </ul>
    </li>
  {% endfor %}
</ul>

  <script>

  var d = {}

  let textBoxes = document.querySelectorAll('[id^=target]');

  let e = 0
  let f = textBoxes.length

  for (let i in textBoxes) {
    if (e < f) {
      if (textBoxes[i].classList.contains("selected")) {
        d[textBoxes[i].getAttribute('data-attribute')] = textBoxes[i].getAttribute('value')
      }
    } else {
      break
    }
    e++
  }

  document.addEventListener('click', function(e) {
  let value = e.target.getAttribute('value');
  d[e.target.getAttribute('data-attribute')] = e.target.getAttribute('value')
  let querystring = buildUrlWithParams(d)
  let url = window.location.href.split('?')[0]
  window.location.href = url + "?" + querystring;
  }, false);

  {% comment %} $('[id^=target]').click(function () {
    const value = this.getAttribute('value');
    d[this.getAttribute('data-attribute')] = this.getAttribute('value')
    const querystring = buildUrlWithParams(d)
    const url = window.location.href.split('?')[0]
    window.location.href = url + "?" + querystring;
  }); {% endcomment %}

  function buildUrlWithParams(data) {
    var searchparams = [];
    for (var d in data)
      searchparams.push(d + '=' + data[d]);
    return searchparams.join('&');
  }

  </script>

  </body>
</html>